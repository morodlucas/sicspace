<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SicSpace</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone.js/14.8.49/Tone.min.js"></script>
    <style>
        /* CSS remains the same as it has no language-specific content */
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0c0c0c, #1a1a2e, #16213e);
            color: white;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container { text-align: center; max-width: 800px; position: relative; z-index: 2; }
        .title { font-size: 2.5rem; margin-bottom: 1rem; text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
        .concept { font-size: 1.1rem; opacity: 0.9; margin-bottom: 2rem; line-height: 1.6; background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px); }
        .controls { display: flex; gap: 15px; justify-content: center; margin: 2rem 0; flex-wrap: wrap; }
        .btn { padding: 15px 25px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 255, 255, 0.3); color: white; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); font-family: inherit; font-size: 1rem; border-radius: 5px; min-width: 120px; }
        .btn:hover { background: rgba(255, 255, 255, 0.2); border-color: rgba(255, 255, 255, 0.5); transform: translateY(-2px); }
        .btn.active { background: rgba(100, 200, 255, 0.3); border-color: rgba(100, 200, 255, 0.7); box-shadow: 0 0 15px rgba(100, 200, 255, 0.3); }
        .status { margin: 1rem 0; font-size: 1.1rem; opacity: 0.8; min-height: 50px; display: flex; align-items: center; justify-content: center; }
        .visualizer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; overflow: hidden; }
        .wave { position: absolute; width: 100px; height: 100px; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 50%; animation: ripple 4s ease-out infinite; }
        @keyframes ripple { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }
        .error-note { position: absolute; width: 6px; height: 6px; background: #ff6b6b; border-radius: 50%; animation: errorFloat 3s ease-in-out infinite; }
        .harmony-note { position: absolute; width: 8px; height: 8px; background: #4ecdc4; border-radius: 50%; animation: harmonyFloat 4s ease-in-out infinite; }
        @keyframes errorFloat { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.3; } 50% { transform: translateY(-30px) rotate(180deg); opacity: 0.9; } }
        @keyframes harmonyFloat { 0%, 100% { transform: translateY(0) scale(1); opacity: 0.4; } 50% { transform: translateY(-20px) scale(1.3); opacity: 0.8; } }
        .explanation { margin-top: 2rem; font-size: 0.9rem; opacity: 0.7; line-height: 1.5; text-align: left; }
    </style>
</head>
<body>
    <div class="visualizer" id="visualizer"></div>
    
    <div class="container">
        <h1 class="title">Welcome to SicSpace</h1>
        
        <div class="concept">
            <strong>Concept:</strong> This is a musical composition born from chance and "error."
            Every dissonance finds its resolution, every "wrong" note discovers its harmony.
            <br><br>
            <em>Beauty emerges not in spite of mistakes, but through them.</em>
        </div>
        
        <div class="controls">
            <button class="btn" id="startBtn">‚ñ∂ Start Music</button>
            <button class="btn" id="chaosBtn">üå™Ô∏è More Chaos</button>
            <button class="btn" id="peaceBtn">üïäÔ∏è More Peace</button>
            <button class="btn" id="stopBtn">‚èπÔ∏è Stop</button>
        </div>

        <div class="status" id="status">
            Press "Start Music" to begin the sound experience
        </div>

        <div class="explanation">
            <strong>How it works:</strong><br>
            ‚Ä¢ <strong>Start:</strong> Begins the composition with a balance between order and chaos<br>
            ‚Ä¢ <strong>More Chaos:</strong> Adds more beautiful "errors" - unexpected notes, broken rhythms<br>
            ‚Ä¢ <strong>More Peace:</strong> Increases harmony - chords that resolve tensions<br>
            ‚Ä¢ <strong>Visualization:</strong> Red dots = "errors", blue dots = harmonies<br><br>
            
            <em>Our mistakes in life, just like in music, can become our most beautiful moments when they find the right context.</em>
        </div>
    </div>

    <script>
        let audioContext = null;
        let isPlaying = false;
        let chaosLevel = 0.5;
        let peaceLevel = 0.5;
        let intervals = [];
        let noteCount = 0;

        // Musical notes in frequencies
        const notes = {
            'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 
            'G4': 392.00, 'A4': 440.00, 'B4': 493.88, 'C5': 523.25
        };

        const errorNotes = {
            'Db4': 277.18, 'Eb4': 311.13, 'Gb4': 369.99, 'Ab4': 415.30, 'Bb4': 466.16
        };

        function createWave(x, y) {
            const wave = document.createElement('div');
            wave.className = 'wave';
            wave.style.left = x + 'px';
            wave.style.top = y + 'px';
            document.getElementById('visualizer').appendChild(wave);
            
            setTimeout(() => {
                if (wave.parentNode) {
                    wave.parentNode.removeChild(wave);
                }
            }, 4000);
        }

        function createNote(isError = false) {
            const note = document.createElement('div');
            note.className = isError ? 'error-note' : 'harmony-note';
            note.style.left = Math.random() * window.innerWidth + 'px';
            note.style.top = Math.random() * window.innerHeight + 'px';
            document.getElementById('visualizer').appendChild(note);
            
            setTimeout(() => {
                if (note.parentNode) {
                    note.parentNode.removeChild(note);
                }
            }, 3000);
        }

        function playNote(frequency, duration = 0.3, isError = false) {
            if (!audioContext) return;

            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = isError ? 'sawtooth' : 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
            
            createNote(isError);
            createWave(Math.random() * window.innerWidth, Math.random() * window.innerHeight);
        }

        function playChord(frequencies, duration = 0.5) {
            frequencies.forEach(freq => {
                playNote(freq, duration, false);
            });
        }

        function generateMusic() {
            if (!isPlaying) return;

            const noteArray = Object.values(notes);
            const errorArray = Object.values(errorNotes);
            
            // Decide whether to play an error or harmony
            if (Math.random() < chaosLevel) {
                // Play "wrong" note
                const errorNote = errorArray[Math.floor(Math.random() * errorArray.length)];
                playNote(errorNote, 0.2, true);
            } else {
                // Play harmonic note
                const harmonicNote = noteArray[Math.floor(Math.random() * noteArray.length)];
                playNote(harmonicNote, 0.4, false);
            }
            
            // Occasionally play chords (more likely with more peace)
            if (Math.random() < peaceLevel * 0.3) {
                const chord = [notes.C4, notes.E4, notes.G4];
                setTimeout(() => {
                    if (isPlaying) playChord(chord);
                }, 200);
            }
            
            noteCount++;
            updateStatus();
        }

        function updateStatus() {
            const chaosPercent = Math.round(chaosLevel * 100);
            const peacePercent = Math.round(peaceLevel * 100);
            
            if (isPlaying) {
                document.getElementById('status').innerHTML = 
                    `üéµ Playing... | Chaos: ${chaosPercent}% | Peace: ${peacePercent}% | Notes: ${noteCount}`;
            }
        }

        async function startMusic() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                await audioContext.resume();
                
                isPlaying = true;
                noteCount = 0;
                
                document.getElementById('startBtn').classList.add('active');
                document.getElementById('startBtn').textContent = 'üéµ Playing...';
                
                // Generate music at varied intervals
                const mainInterval = setInterval(() => {
                    if (isPlaying) {
                        generateMusic();
                    } else {
                        clearInterval(mainInterval);
                    }
                }, 800 - (chaosLevel * 400)); // More chaos = more irregular rhythm
                
                intervals.push(mainInterval);
                updateStatus();
                
            } catch (error) {
                document.getElementById('status').textContent = 'Error starting audio. Please try again.';
                console.error('Audio error:', error);
            }
        }

        function stopMusic() {
            isPlaying = false;
            intervals.forEach(interval => clearInterval(interval));
            intervals = [];
            
            if (audioContext) {
                audioContext.close();
                audioContext = null;
            }
            
            document.getElementById('startBtn').classList.remove('active');
            document.getElementById('startBtn').textContent = '‚ñ∂ Start Music';
            document.getElementById('status').textContent = 'Music stopped. Silence is also beautiful.';
        }

        function increaseChaos() {
            chaosLevel = Math.min(1, chaosLevel + 0.2);
            peaceLevel = Math.max(0, peaceLevel - 0.1);
            
            if (isPlaying) {
                updateStatus();
                // Play some chaotic notes immediately
                setTimeout(() => playNote(Object.values(errorNotes)[Math.floor(Math.random() * 5)], 0.1, true), 0);
                setTimeout(() => playNote(Object.values(errorNotes)[Math.floor(Math.random() * 5)], 0.1, true), 100);
            } else {
                document.getElementById('status').textContent = `Chaos increased to ${Math.round(chaosLevel * 100)}%. Start the music to hear it.`;
            }
        }

        function increasePeace() {
            peaceLevel = Math.min(1, peaceLevel + 0.2);
            chaosLevel = Math.max(0, chaosLevel - 0.1);
            
            if (isPlaying) {
                updateStatus();
                // Play a harmonious chord immediately
                playChord([notes.C4, notes.E4, notes.G4, notes.C5], 0.8);
            } else {
                document.getElementById('status').textContent = `Peace increased to ${Math.round(peaceLevel * 100)}%. Start the music to hear it.`;
            }
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startMusic);
        document.getElementById('stopBtn').addEventListener('click', stopMusic);
        document.getElementById('chaosBtn').addEventListener('click', increaseChaos);
        document.getElementById('peaceBtn').addEventListener('click', increasePeace);

        // Initialization
        document.getElementById('status').textContent = 'Ready? Press "Start Music" to begin the experience.';
    </script>
</body>
</html>